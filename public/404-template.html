<!DOCTYPE html>
<html lang="en">
<head>
  <!-- NUCLEAR OPTION PATH FIX - Must be the very first script to execute -->
  <script src="nuclear-path-fix.js"></script>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><!-- SITE_TITLE_PLACEHOLDER --> - Redirecting...</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 50px;
      background-color: #f8f5f0;
      color: #5c4033;
    }
    .redirect-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 30px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      color: #8b5a2b;
    }
    .logo {
      max-width: 180px;
      margin-bottom: 20px;
    }
    .spinner {
      margin: 20px auto;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(139, 90, 43, 0.1);
      border-radius: 50%;
      border-top-color: #8b5a2b;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
  
  <!-- ABSOLUTE LAST RESORT FIX for persistent repository path issues -->
  <script>
    // Emergency fix that runs immediately
    (function() {
      function emergencyClean() {
        // Get repo name (try all possible sources)
        const repoName = window.REPO_BASE?.replace(/^\/|\/$/g, '') || '';
        
        if (window.location.hash && repoName) {
          // Create variants of repo name for checking
          const repoNameLower = repoName.toLowerCase();
          const dashVersion = repoNameLower.replace(/\s+/g, '-');
          const noSpaceVersion = repoNameLower.replace(/\s+/g, '');
          
          // Check for any variant in the URL
          if (
            window.location.hash.toLowerCase().includes('/' + repoNameLower + '/') || 
            window.location.hash.toLowerCase().includes('/' + dashVersion + '/') ||
            window.location.hash.toLowerCase().includes('/' + noSpaceVersion + '/')
          ) {
            console.error('[EmergencyFix] Repository name STILL in URL after all fixes! Forcing clean path');
            window.location.hash = '#/';
          }
        }
      }
      
      // Run immediately
      emergencyClean();
      
      // Run again after delays
      setTimeout(emergencyClean, 200);
      setTimeout(emergencyClean, 500);
      setTimeout(emergencyClean, 1000);
    })();
  </script>
</head>
<body>
  <div class="redirect-container">
    <h1><!-- SITE_TITLE_PLACEHOLDER --></h1>
    <p>Redirecting you to the homepage...</p>
    <div class="spinner"></div>
  </div>

  <script>
    (function() {
      // Enhanced GitHub Pages 404 redirect handler v6.0 
      // (Aggressive repository path sanitization)
      
      // Log redirection
      console.log("[404 Redirect] Enhanced handler v6.0 initializing...");
      
      // Get the current path and clean it
      var path = window.location.pathname;
      
      // Configuration set by the build system
      window.REPO_BASE = '<!-- REPO_BASE_PLACEHOLDER -->'; // Will be replaced during build
      
      // Known repository name variations (case insensitive) - will include the user's custom repo name
      var REPO_VARIANTS = ['<!-- REPO_VARIANTS_PLACEHOLDER -->'];
      
      // Function to detect repository name from multiple sources
      function detectRepoName() {
        // First check if the repository base is configured
        if (window.REPO_BASE) {
          var configuredRepo = window.REPO_BASE.replace(/^\/|\/$/g, '');
          if (configuredRepo) {
            console.log("[404 Redirect] Using configured repository name:", configuredRepo);
            return configuredRepo;
          }
        }
        
        // If on GitHub Pages, try to extract from the URL
        if (window.location.hostname.indexOf('github.io') !== -1) {
          const pathParts = path.split('/').filter(function(part) { return part !== ''; });
          if (pathParts.length > 0) {
            console.log("[404 Redirect] Detected repository from URL path:", pathParts[0]);
            return pathParts[0]; // The repo name is the first path segment
          }
        }
        
        // As a last resort, try to get it from the base tag
        var baseTag = document.querySelector('base');
        if (baseTag && baseTag.href) {
          var baseUrl = baseTag.href;
          var basePathMatch = baseUrl.match(/\/([^\/]+)\/$/);
          if (basePathMatch && basePathMatch[1]) {
            console.log("[404 Redirect] Detected repository from base tag:", basePathMatch[1]);
            return basePathMatch[1];
          }
        }
        
        // Default fallback, will be replaced during build
        return "<!-- REPO_NAME_PLACEHOLDER -->";
      }
      
      var repoName = detectRepoName();
      console.log("[404 Redirect] Detected repository name: " + repoName);
      
      // Clean the repository name from all paths
      function cleanPath(inputPath) {
        if (!inputPath) return '/';
        
        var cleanedPath = inputPath;
        
        // First, handle the actual repository name
        if (cleanedPath.indexOf('/' + repoName + '/') === 0) {
          cleanedPath = cleanedPath.replace('/' + repoName, '');
        }
        
        // Then check all variants of the repository name (case insensitive)
        for (var i = 0; i < REPO_VARIANTS.length; i++) {
          var variant = REPO_VARIANTS[i];
          
          // Create a case-insensitive RegExp to match the repo name
          var repoRegExp = new RegExp('\\/' + variant + '\\/', 'i');
          
          if (repoRegExp.test(cleanedPath)) {
            console.warn("[404 Redirect] Detected repository variant in path: " + variant);
            // Use the actual variant that was found in the string
            var foundVariant = cleanedPath.match(repoRegExp)[0].replace(/\//g, '');
            cleanedPath = cleanedPath.replace(new RegExp('\\/' + foundVariant + '\\/', 'i'), '/');
          }
        }
        
        // If path is empty or just a slash, set to root
        if (cleanedPath === '' || cleanedPath === '/') {
          cleanedPath = '/';
        }
        
        return cleanedPath;
      }
      
      // Clean the path
      path = cleanPath(path);
      console.log("[404 Redirect] Cleaned path: " + path);
      
      // Preserve query parameters if any
      var queryString = window.location.search || '';
      
      // Create redirect URL with hash for SPA routing
      var redirectUrl = window.location.origin;
      
      // Add repository name if needed (for GitHub Pages)
      if (window.location.hostname.indexOf('github.io') !== -1) {
        redirectUrl += '/' + repoName;
      }
      
      // Add hash path for SPA routing (ensure path starts with a slash)
      if (path.charAt(0) !== '/') {
        path = '/' + path;
      }
      
      redirectUrl += '/#' + path + queryString;
      
      console.log("[404 Redirect] Redirecting to: " + redirectUrl);
      
      // Check for endless redirect loops
      var redirectCount = sessionStorage.getItem('redirectCount') || 0;
      redirectCount = parseInt(redirectCount, 10) + 1;
      sessionStorage.setItem('redirectCount', redirectCount);
      
      if (redirectCount > 5) {
        console.error("[404 Redirect] Detected possible redirect loop (count: " + redirectCount + ")");
        // Force redirect to the homepage as a fallback
        window.location.replace(window.location.origin + '/' + repoName + '/#/');
        // Clear the count to allow future redirects
        sessionStorage.removeItem('redirectCount');
      } else {
        // Normal redirect
        window.location.replace(redirectUrl);
      }
    })();
  </script>
</body>
</html>